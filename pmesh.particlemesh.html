<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>pmesh.particlemesh module &#8212; PyPM 0.1 documentation</title>
    
    <link rel="stylesheet" href="_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="pmesh.pm module" href="pmesh.pm.html" />
    <link rel="prev" title="pmesh.lanczos module" href="pmesh.lanczos.html" /> 
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="pmesh.pm.html" title="pmesh.pm module"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="pmesh.lanczos.html" title="pmesh.lanczos module"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">PyPM 0.1 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="modules.html" >pmesh</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="pmesh.html" accesskey="U">pmesh package</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="module-pmesh.particlemesh">
<span id="pmesh-particlemesh-module"></span><h1>pmesh.particlemesh module<a class="headerlink" href="#module-pmesh.particlemesh" title="Permalink to this headline">¶</a></h1>
<p>PyPM: A Particle Mesh code in Python</p>
<dl class="class">
<dt id="pmesh.particlemesh.ParticleMesh">
<em class="property">class </em><code class="descclassname">pmesh.particlemesh.</code><code class="descname">ParticleMesh</code><span class="sig-paren">(</span><em>BoxSize</em>, <em>Nmesh</em>, <em>paintbrush='cic'</em>, <em>comm=None</em>, <em>np=None</em>, <em>verbose=False</em>, <em>dtype='f8'</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pmesh/particlemesh.html#ParticleMesh"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pmesh.particlemesh.ParticleMesh" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal"><span class="pre">object</span></code></p>
<p>ParticleMesh provides an interface to solver for forces
with particle mesh method</p>
<p>ParticleMesh object is a state machine. Refer to <a class="reference internal" href="intro.html#introduction"><span class="std std-ref">Introduction</span></a> on 
the standard steps to use this object.</p>
<p>Memory usage is twice the size of the FFT mesh. However, 
Be aware the transfer functions may take more memory.</p>
<p class="rubric">Attributes</p>
<table border="1" class="docutils">
<colgroup>
<col width="2%" />
<col width="98%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>np</td>
<td>(array_like (npx, npy)) The shape of the process mesh. This is the number of domains per direction. The product of the items shall equal to the size of communicator. For example, for 64 rank job, np = (8, 8) is a good choice. Since for now only 3d simulations are supported, np must be of length-2. The default is try to split the total number of ranks equally. (eg, for a 64 rank job, default is (8, 8)</td>
</tr>
<tr class="row-even"><td>comm</td>
<td>(<code class="xref py py-class docutils literal"><span class="pre">MPI.Comm</span></code>) the MPI communicator, (default is MPI.COMM_WORLD)</td>
</tr>
<tr class="row-odd"><td>Nmesh</td>
<td>(int) number of mesh points per side. Only 3d simulations are supported by now, and the true mesh is [Nmesh, Nmesh, Nmesh]</td>
</tr>
<tr class="row-even"><td>BoxSize</td>
<td>(float) size of box</td>
</tr>
<tr class="row-odd"><td>domain</td>
<td>(<a class="reference internal" href="pmesh.domain.html#pmesh.domain.GridND" title="pmesh.domain.GridND"><code class="xref py py-class docutils literal"><span class="pre">pmesh.domain.GridND</span></code></a>) domain decomposition (private)</td>
</tr>
<tr class="row-even"><td>partition</td>
<td>(<code class="xref py py-class docutils literal"><span class="pre">pfft.Partition</span></code>) domain partition (private)</td>
</tr>
<tr class="row-odd"><td>real</td>
<td>(array_like) the real FFT array (private)</td>
</tr>
<tr class="row-even"><td>complex</td>
<td>(array_like) the complex FFT array (private)</td>
</tr>
<tr class="row-odd"><td>w</td>
<td>(list) a list of the circular frequencies along each direction (-pi to pi)</td>
</tr>
<tr class="row-even"><td>k</td>
<td>(list) a list of the wave numbers k along each direction (- pi N/ L to pi N/ L)</td>
</tr>
<tr class="row-odd"><td>x</td>
<td>(list) a list of the position along each direction (-L/2 to L/ 2). x is conjugate of k.</td>
</tr>
<tr class="row-even"><td>r</td>
<td>(list) a list of the mesh position along each direction (-N/2 to N/2). r is conjugate of w.</td>
</tr>
<tr class="row-odd"><td>T</td>
<td>(<a class="reference internal" href="pmesh.tools.html#pmesh.tools.Timers" title="pmesh.tools.Timers"><code class="xref py py-class docutils literal"><span class="pre">pmesh.tools.Timers</span></code></a>) profiling timers</td>
</tr>
</tbody>
</table>
<dl class="method">
<dt id="pmesh.particlemesh.ParticleMesh.c2r">
<code class="descname">c2r</code><span class="sig-paren">(</span><em>transfer_functions=[]</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pmesh/particlemesh.html#ParticleMesh.c2r"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pmesh.particlemesh.ParticleMesh.c2r" title="Permalink to this definition">¶</a></dt>
<dd><p>Complex to real transformation.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><p class="first"><strong>transfer_functions</strong> : list of <code class="xref py py-class docutils literal"><span class="pre">transfer.TransferFunction</span></code></p>
<blockquote class="last">
<div><p>A chain of transfer functions to apply to the complex field.</p>
</div></blockquote>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="pmesh.particlemesh.ParticleMesh.clear">
<code class="descname">clear</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/pmesh/particlemesh.html#ParticleMesh.clear"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pmesh.particlemesh.ParticleMesh.clear" title="Permalink to this definition">¶</a></dt>
<dd><p>Clear the internal real canvas.</p>
<p>This function simply set real[:] = 0. After <a class="reference internal" href="#pmesh.particlemesh.ParticleMesh.clear" title="pmesh.particlemesh.ParticleMesh.clear"><code class="xref py py-meth docutils literal"><span class="pre">clear()</span></code></a>, 
<a class="reference internal" href="#pmesh.particlemesh.ParticleMesh.paint" title="pmesh.particlemesh.ParticleMesh.paint"><code class="xref py py-meth docutils literal"><span class="pre">paint()</span></code></a> can correctly paint to the canvas.</p>
<p class="rubric">Notes</p>
<p>A freshly created <a class="reference internal" href="#pmesh.particlemesh.ParticleMesh" title="pmesh.particlemesh.ParticleMesh"><code class="xref py py-class docutils literal"><span class="pre">ParticleMesh</span></code></a> object come with
a cleared canvas.</p>
</dd></dl>

<dl class="method">
<dt id="pmesh.particlemesh.ParticleMesh.decompose">
<code class="descname">decompose</code><span class="sig-paren">(</span><em>pos</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pmesh/particlemesh.html#ParticleMesh.decompose"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pmesh.particlemesh.ParticleMesh.decompose" title="Permalink to this definition">¶</a></dt>
<dd><p>Create a domain decompose layout for particles at given
coordinates.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><p class="first"><strong>pos</strong> : array_like (, ndim)</p>
<blockquote>
<div><p>position of particles in simulation  unit</p>
</div></blockquote>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first"><strong>layout</strong> : :py:class:domain.Layout</p>
<blockquote>
<div><p>layout that can be used to migrate particles and images</p>
</div></blockquote>
<p class="last">to the correct MPI ranks that hosts the PM local mesh</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="pmesh.particlemesh.ParticleMesh.paint">
<code class="descname">paint</code><span class="sig-paren">(</span><em>pos</em>, <em>mass=1.0</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pmesh/particlemesh.html#ParticleMesh.paint"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pmesh.particlemesh.ParticleMesh.paint" title="Permalink to this definition">¶</a></dt>
<dd><p>Paint particles into the internal real canvas.</p>
<p>Transform the particle field given by pos and mass
to the overdensity field in fourier space and save
it in the internal storage. 
A multi-linear CIC approximation scheme is used.</p>
<p>The function can be called multiple times: 
the result is cummulative. In a multi-step simulation where
<a class="reference internal" href="#pmesh.particlemesh.ParticleMesh" title="pmesh.particlemesh.ParticleMesh"><code class="xref py py-class docutils literal"><span class="pre">ParticleMesh</span></code></a> object is reused,  before calling 
<a class="reference internal" href="#pmesh.particlemesh.ParticleMesh.paint" title="pmesh.particlemesh.ParticleMesh.paint"><code class="xref py py-meth docutils literal"><span class="pre">paint()</span></code></a>, make sure the canvas is cleared with <a class="reference internal" href="#pmesh.particlemesh.ParticleMesh.clear" title="pmesh.particlemesh.ParticleMesh.clear"><code class="xref py py-meth docutils literal"><span class="pre">clear()</span></code></a>.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><p class="first"><strong>pos</strong> : array_like (, ndim)</p>
<blockquote>
<div><p>position of particles in simulation  unit</p>
</div></blockquote>
<p><strong>mass</strong> : scalar or array_like (,)</p>
<blockquote class="last">
<div><p>mass of particles in simulation  unit</p>
</div></blockquote>
</td>
</tr>
</tbody>
</table>
<p class="rubric">Notes</p>
<p>self.real is the density field (<img class="math" src="_images/math/bda77f4be4f1afcab5eee2969aef42f613092f9c.png" alt="\rho(x)"/>) after this operation. (In units of per cubic distance)</p>
</dd></dl>

<dl class="method">
<dt id="pmesh.particlemesh.ParticleMesh.pop">
<code class="descname">pop</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/pmesh/particlemesh.html#ParticleMesh.pop"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pmesh.particlemesh.ParticleMesh.pop" title="Permalink to this definition">¶</a></dt>
<dd><p>Restore the complex field</p>
<p>The complex field was saved to an internal stack by <a class="reference internal" href="#pmesh.particlemesh.ParticleMesh.push" title="pmesh.particlemesh.ParticleMesh.push"><code class="xref py py-meth docutils literal"><span class="pre">push()</span></code></a>.</p>
</dd></dl>

<dl class="method">
<dt id="pmesh.particlemesh.ParticleMesh.push">
<code class="descname">push</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/pmesh/particlemesh.html#ParticleMesh.push"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pmesh.particlemesh.ParticleMesh.push" title="Permalink to this definition">¶</a></dt>
<dd><p>Save the complex field</p>
<p>The complex field is saved to an internal stack. Recover the
complex field with <a class="reference internal" href="#pmesh.particlemesh.ParticleMesh.pop" title="pmesh.particlemesh.ParticleMesh.pop"><code class="xref py py-meth docutils literal"><span class="pre">pop()</span></code></a>.</p>
</dd></dl>

<dl class="method">
<dt id="pmesh.particlemesh.ParticleMesh.r2c">
<code class="descname">r2c</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/pmesh/particlemesh.html#ParticleMesh.r2c"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pmesh.particlemesh.ParticleMesh.r2c" title="Permalink to this definition">¶</a></dt>
<dd><p>Perform real to complex FFT on the internal canvas.</p>
<p>The complex field will be dimensionless; this is to ensure if NormalizeDC
is applyed, c2r produces <img class="math" src="_images/math/51963dd5cb0bf9a874e42e9b61ce7b66ef617d8e.png" alt="1 + \delta"/> as expected.</p>
<p>(To obtain CFT, multiply by <img class="math" src="_images/math/65602970fb45bcf5d43213f9b6bff3e5a1b83a0a.png" alt="L^3"/> from the <img class="math" src="_images/math/9a29e76890e1c98e013ba6fbc6ab135445e210ad.png" alt="dx^3"/> factor )</p>
<p>Therefore, the zeroth component of the complex field is <img class="math" src="_images/math/4b7619529452573af57f70d9770b5af545379458.png" alt="\bar\rho"/>.</p>
</dd></dl>

<dl class="method">
<dt id="pmesh.particlemesh.ParticleMesh.readout">
<code class="descname">readout</code><span class="sig-paren">(</span><em>pos</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pmesh/particlemesh.html#ParticleMesh.readout"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pmesh.particlemesh.ParticleMesh.readout" title="Permalink to this definition">¶</a></dt>
<dd><p>Read out from real field at positions</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><p class="first"><strong>pos</strong> : array_like (, ndim)</p>
<blockquote>
<div><p>position of particles in simulation  unit</p>
</div></blockquote>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first"><strong>rt</strong> : array_like (,)</p>
<blockquote class="last">
<div><p>read out values from the real field.</p>
</div></blockquote>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="pmesh.particlemesh.ParticleMesh.transfer">
<code class="descname">transfer</code><span class="sig-paren">(</span><em>transfer_functions</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pmesh/particlemesh.html#ParticleMesh.transfer"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pmesh.particlemesh.ParticleMesh.transfer" title="Permalink to this definition">¶</a></dt>
<dd><p>Apply transfer functions</p>
<p>Apply a chain of transfer functions to the complex field, in place.
If the original field shall be preserved, use <a class="reference internal" href="#pmesh.particlemesh.ParticleMesh.push" title="pmesh.particlemesh.ParticleMesh.push"><code class="xref py py-meth docutils literal"><span class="pre">push()</span></code></a>.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><p class="first"><strong>transfer_functions</strong> : list of :py:class:transfer.TransferFunction</p>
<blockquote class="last">
<div><p>A chain of transfer functions to apply to the complex field.</p>
</div></blockquote>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="pmesh.particlemesh.ParticleMesh.transform">
<code class="descname">transform</code><span class="sig-paren">(</span><em>x</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pmesh/particlemesh.html#ParticleMesh.transform"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pmesh.particlemesh.ParticleMesh.transform" title="Permalink to this definition">¶</a></dt>
<dd><p>Transform from simulation unit to local grid unit.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><p class="first"><strong>x</strong> : array_like (, ndim)</p>
<blockquote>
<div><p>coordinates in simulation unit</p>
</div></blockquote>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first"><strong>ret</strong> : array_like (, ndim)</p>
<blockquote class="last">
<div><p>coordinates in local grid unit</p>
</div></blockquote>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="pmesh.particlemesh.ParticleMesh.transform0">
<code class="descname">transform0</code><span class="sig-paren">(</span><em>x</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pmesh/particlemesh.html#ParticleMesh.transform0"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pmesh.particlemesh.ParticleMesh.transform0" title="Permalink to this definition">¶</a></dt>
<dd><p>Transform from simulation unit to global grid unit.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><p class="first"><strong>x</strong> : array_like (, ndim)</p>
<blockquote>
<div><p>coordinates in simulation unit</p>
</div></blockquote>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first"><strong>ret</strong> : array_like (, ndim)</p>
<blockquote class="last">
<div><p>coordinates in global grid unit</p>
</div></blockquote>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h4>Previous topic</h4>
  <p class="topless"><a href="pmesh.lanczos.html"
                        title="previous chapter">pmesh.lanczos module</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="pmesh.pm.html"
                        title="next chapter">pmesh.pm module</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/pmesh.particlemesh.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="pmesh.pm.html" title="pmesh.pm module"
             >next</a> |</li>
        <li class="right" >
          <a href="pmesh.lanczos.html" title="pmesh.lanczos module"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">PyPM 0.1 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="modules.html" >pmesh</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="pmesh.html" >pmesh package</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2015, Yu Feng.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.5.1.
    </div>
  </body>
</html>